<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart NID Maker - Full Card</title>
<link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;700&display=swap" rel="stylesheet">
<script src="https://unpkg.com/bwip-js/dist/bwip-js-min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<style>
:root { --main-color: #000800; --card-w: 330px; --card-h: 220px; }
body { font-family: 'Hind Siliguri', sans-serif; background:#f0f2f5; margin:0; padding:15px; display:flex; flex-direction:column; align-items:center; }
.main-wrapper { display:flex; flex-direction:column; gap:20px; align-items:center; width:100%; }

/* Editor Form */
.editor-box { background: #fff; width: 100%; max-width: 500px; padding: 20px; border-top: 5px solid var(--main-color); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
.editor-header h3 { margin:0 0 15px; font-size:16px; color:var(--main-color); text-align:center; }
.grid-form { display:flex; flex-direction:column; gap:8px; }
.input-group { display:flex; flex-direction:column; margin-bottom:10px; }
label { font-size:12px; font-weight:bold; color:#555; margin-bottom:3px; }
input, textarea { padding:8px 10px; border:1px solid #ddd; border-radius:6px; font-family:'Hind Siliguri', sans-serif; font-size:13px; outline:none; width:100%; text-align:left; box-sizing:border-box; }

.btn-generate, .btn-download { width:100%; padding:12px; border:none; border-radius:6px; font-size:15px; font-weight:bold; cursor:pointer; margin-top:10px; }
.btn-generate { background: var(--main-color); color:white; }
.btn-download { background:#27ae60; color:white; }

/* Card Display */
.card-display { display:flex; flex-wrap: wrap; gap:20px; justify-content:center; align-items:flex-start; }

/* Card Base */
.nid-card { width: var(--card-w); height: var(--card-h); background: #fff; border: 1px solid black; display:flex; flex-direction:column; position:relative; box-sizing:border-box; margin:0; }
.header { height:80px; border-bottom:1px solid #000; display:flex; align-items:center; justify-content:flex-start; padding:0 15px; box-sizing:border-box; }
.logo { width:37px; height:auto; margin-left:-8px; margin-right:-1px; }
.header-center { flex:1; text-align:center; line-height:0.8; }
.bn-gov { font-size:16px; font-weight:700; line-height:1.1; }
.en-gov { font-size:10px; font-weight:700; color:#27ae60; line-height:1.5; }
.title-card { font-size:10px; font-weight:bold; }
.red-txt { color:red; font-weight:bold; }
.body-card { display:flex; padding:8px; position:relative; height:calc(100% - 55px); }
.watermark-main { position:absolute; top:43%; left:55%; transform:translate(-50%,-50%); width:130px; opacity:0.3; z-index:1; pointer-events:none; }
.photo-sign { display:flex; flex-direction:column; align-items:center; z-index:5; }
.photo-frame { width:70px; height:90px; border:0.5px solid #888; background:#eee; overflow:hidden; }
.photo-frame img { width:100%; height:100%; object-fit:cover; }
.sign-frame { width:65px; height:22px; margin-top:4px; }
.sign-frame img { width:100%; height:100%; object-fit:contain; }

.info-side { margin-left:20px; z-index:5; font-size:13px; font-weight:600; color:black; display:flex; flex-direction:column; justify-content:flex-start; height:100%; width:220px; line-height:20px; }
.info-row { display:flex; justify-content:flex-start; margin-bottom:4px; }
.info-label { width:85px; font-weight:600; text-align:left; font-size:13px; }
.info-value { flex:1; margin-left:-3px; margin-top:0px; text-align:left; font-weight:600; font-size:13px; }
.dob-red { color:red; font-weight:800; font-size:13px; }
.id-row { display:flex; justify-content:flex-start; font-size:14px; font-weight:900; margin-top:5px; }
.id-row .info-value { color:red; font-size:16px; margin-left:-30px; }

.nid-back{ padding:8px; display:flex; flex-direction:column; height:100%; box-sizing:border-box; }
.instruction { font-size:9.5px; line-height:1.9; font-weight:600; margin-bottom:4px; margin-top:-7px; }
.address-box { font-size:12px; line-height:1.3; padding:2px 0; margin-bottom:5px; }
.footer-section{ display:flex; flex-direction:column; margin-top:auto; }
.footer-section img{ width:50px; margin-bottom:-4px; }
.barcode-container{ width:100%; height:35px; margin-top:15px; }
.barcode-container canvas{ width:100% !important; height:100% !important; }

.history-box { width:100%; max-width:500px; background:#fff; padding:10px; border:1px solid #ddd; border-radius:6px; font-size:12px; margin-top:10px; }
.history-box h4{ margin:0 0 5px; font-size:14px; font-weight:700; }
.history-box ul{ list-style:none; padding:0; margin:0; max-height:150px; overflow-y:auto; }
.history-box li{ border-bottom:1px solid #eee; padding:4px 0; }

/* Back photo full */
.back-photo-box{ width:100%; height:100%; overflow:hidden; position:relative; }
.back-photo{ width:100%; height:100%; object-fit:cover; display:block; }

@media print{ .editor-box,.btn-generate,.btn-download,.history-box{display:none;} .card-display{display:block;} .nid-card{box-shadow:none; border:1px solid #000; margin-bottom:30px;} }
</style>
</head>
<body>
<div class="main-wrapper">

<!-- Editor Form -->
<div class="editor-box">
    <div class="editor-header"><h3>Creat  NID card </h3></div>
    <div class="grid-form">
        <div class="input-group"><label>নাম (বাংলায়)</label><input type="text" id="in-bn" placeholder="নাম লিখুন"></div>
        <div class="input-group"><label>Name (English)</label><input type="text" id="in-en" placeholder="Name"></div>
        <div class="input-group"><label>পিতার নাম</label><input type="text" id="in-p" placeholder="পিতার নাম"></div>
        <div class="input-group"><label>মাতার নাম</label><input type="text" id="in-m" placeholder="মাতার নাম"></div>
        <div class="input-group"><label>NID নম্বর</label><input type="text" id="in-id" placeholder="NID"></div>
        <div class="input-group"><label>জন্ম তারিখ</label><input type="text" id="in-dob" placeholder="DD MMM YYYY"></div>
        <div class="input-group"><label>গ্রাম/রাস্তা</label><input type="text" id="in-ad" placeholder="হোল্ডিং-গ্রাম/রাস্তা/"></div>
        <div class="input-group"><label>ডাকঘর</label><input type="text" id="in-postoffice" placeholder="ডাকঘর"></div>
        <div class="input-group"><label>পোস্টকোড</label><input type="text" id="in-postcode" placeholder="পোস্টকোড"></div>
        <div class="input-group"><label>উপজেলা</label><input type="text" id="in-upazila" placeholder="উপজেলা"></div>
        <div class="input-group"><label>জেলা</label><input type="text" id="in-district" placeholder="জেলা"></div>
        <div class="input-group"><label>Blood Group</label><input type="text" id="in-blood" placeholder="O+"></div>
        <div class="input-group"><label>জন্মস্থান</label><input type="text" id="in-place" placeholder="Place"></div>
        <div class="input-group"><label>নিজের ছবি</label><input type="file" accept="image/*" onchange="preview(this,'v-photo')"></div>
        <div class="input-group"><label>স্বাক্ষর</label><input type="file" accept="image/*" onchange="preview(this,'v-sign')"></div>
    </div>
    <button class="btn-generate" onclick="updateCard()">Generate NID</button>
    <button class="btn-download" onclick="downloadCard()">Download NID</button>
</div>

<!-- Card Display -->
<div class="card-display" id="nid-card-wrapper">

<!-- Front Card -->
<div class="nid-card" id="front-card">
    <div class="header">
        <img src="https://upload.wikimedia.org/wikipedia/commons/8/84/Government_Seal_of_Bangladesh.svg" class="logo">
        <div class="header-center">
            <div class="bn-gov">গণপ্রজাতন্ত্রী বাংলাদেশ সরকার</div>
            <div class="en-gov">Government of the People's Republic of Bangladesh</div>
            <div class="title-card">NATIONAL ID CARD / <span class="red-txt">জাতীয় পরিচয় পত্র</span></div>
        </div>
    </div>
    <div class="body-card">
        <img src="https://upload.wikimedia.org/wikipedia/commons/8/81/National_emblem_of_Bangladesh.svg" class="watermark-main">
        <div class="photo-sign">
            <div class="photo-frame"><img id="v-photo" src="https://via.placeholder.com/70x90?text=PHOTO"></div>
            <div class="sign-frame"><img id="v-sign" src="https://via.placeholder.com/65x22?text=SIGN"></div>
        </div>
        <div class="info-side">
            <div class="info-row"><div class="info-label">নাম:</div><div class="info-value" id="o-bn"></div></div>
            <div class="info-row"><div class="info-label">Name:</div><div class="info-value" id="o-en"></div></div>
            <div class="info-row"><div class="info-label">পিতা:</div><div class="info-value" id="o-p"></div></div>
            <div class="info-row"><div class="info-label">মাতা:</div><div class="info-value" id="o-m"></div></div>
            <div class="info-row"><div class="info-label">Date of Birth:</div><div class="info-value dob-red" id="o-dob"></div></div>
            <div class="id-row"><div class="info-label">ID NO:</div><div class="info-value" id="o-id"></div></div>
        </div>
    </div>
</div>

<!-- Back Card -->
<div class="nid-card" id="back-card">
    <div class="nid-back">
        <div class="instruction">
            এই কার্ডটি গণপ্রজাতন্ত্রী বাংলাদেশ সরকারের সম্পত্তি। কার্ডটি ব্যবহারকারী ব্যতীত অন্য কোথাও পাওয়া গেলে নিকটস্থ পোস্ট অফিসে জমা দেওয়ার জন্য অনুরোধ করা হলো।
        </div>
        <div style="border-bottom:1px solid #000; padding-bottom:5px; margin-left:-9px; margin-right:-9px; margin-top:-8px;"></div>
        <div class="address-box"><strong>ঠিকানা:<b> গ্রাম/রাস্তা </b></strong> <span id="o-ad-full"></span></div>
        <div style="display:flex; align-items:center; font-size:10px; font-weight:bold; margin-top:20px;">
            <div style="flex:1; text-align:left;">ব্লাড গ্রুপ/Blood Group: <strong id="o-blood" style="color:red;"></strong></div>
            <div style="flex:1; text-align:left;">জন্মস্থান: <span id="o-place"></span></div>
            <span style="background:black; color:white; padding:2px 5px; border-radius:0px; font-size:9px; margin-right:-8.1px;">মুদ্রণ: ০১</span>
        </div>
        <div style="border-bottom:1px solid #000; padding-bottom:0px; margin-left:-9px; margin-right:-9px;"></div>
        <div class="footer-section">
            <img src="https://upload.wikimedia.org/wikipedia/commons/3/3a/Jon_Kirsch%27s_Signature.png">
            <div style="width:100%; display:flex; justify-content:space-between; font-size:9px; font-weight:600;">
                <span>প্রদানকারী কর্তৃপক্ষের স্বাক্ষর</span>
                <span>প্রদানের তারিখ: ২১/১০/২০১০</span>
            </div>
        </div>
        <div class="barcode-container"><canvas id="barcode-canvas"></canvas></div>
    </div>
</div>

</div> <!-- card-display -->

<!-- History Box -->
<div class="history-box">
    <h4>History & Counters</h4>
    <div>Generated: <span id="generate-count">0</span> | Downloaded: <span id="download-count">0</span></div>
    <ul id="history-list"></ul>
</div>

<script>
    let generateCount = 0;
    let downloadCount = 0;
    
    /* =========================
       LOAD SAVED DATA ON START
    ========================= */
    window.addEventListener("DOMContentLoaded", function() {
        
        const savedHistory = localStorage.getItem("nidHistory");
        const savedGenerate = localStorage.getItem("generateCount");
        const savedDownload = localStorage.getItem("downloadCount");
        
        if (savedHistory) {
            document.getElementById("history-list").innerHTML = savedHistory;
        }
        
        if (savedGenerate) {
            generateCount = parseInt(savedGenerate);
            document.getElementById("generate-count").innerText = generateCount;
        }
        
        if (savedDownload) {
            downloadCount = parseInt(savedDownload);
            document.getElementById("download-count").innerText = downloadCount;
        }
    });
    
    
    /* =========================
       IMAGE PREVIEW
    ========================= */
    function preview(input, id) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById(id).src = e.target.result;
            }
            reader.readAsDataURL(input.files[0]);
        }
    }
    
    
    /* =========================
       BARCODE GENERATOR
    ========================= */
    function generateBarcode(text) {
        try {
            bwipjs.toCanvas('barcode-canvas', {
                bcid: 'pdf417',
                text: text + " " + text + " NIDBD",
                scale: 2.5,
                height: 14,
                includetext: false,
                eclevel: 8
            });
        } catch (e) { console.log(e); }
    }
    
    
    /* =========================
       GENERATE BUTTON
    ========================= */
    function updateCard() {
        
        const bn = document.getElementById('in-bn').value;
        const en = document.getElementById('in-en').value;
        const p = document.getElementById('in-p').value;
        const m = document.getElementById('in-m').value;
        const id = document.getElementById('in-id').value;
        const dob = document.getElementById('in-dob').value;
        const ad = document.getElementById('in-ad').value;
        const post = document.getElementById('in-postoffice').value;
        const postcode = document.getElementById('in-postcode').value;
        const upazila = document.getElementById('in-upazila').value;
        const district = document.getElementById('in-district').value;
        const blood = document.getElementById('in-blood').value;
        const place = document.getElementById('in-place').value;
        
        document.getElementById('o-bn').innerText = bn;
        document.getElementById('o-en').innerText = en;
        document.getElementById('o-p').innerText = p;
        document.getElementById('o-m').innerText = m;
        document.getElementById('o-id').innerText = id;
        document.getElementById('o-dob').innerText = dob;
        
        let fullAddress = `${ad}, ${post}, ${postcode}, ${upazila}, ${district}`;
        document.getElementById('o-ad-full').innerText = fullAddress;
        
        document.getElementById('o-blood').innerText = blood;
        document.getElementById('o-place').innerText = place;
        
        generateBarcode(id);
        
        /* Counter Update */
        generateCount++;
        document.getElementById('generate-count').innerText = generateCount;
        
        /* History Add */
        const historyList = document.getElementById('history-list');
        const li = document.createElement('li');
        const timestamp = new Date().toLocaleString('bn-BD', { hour12: false });
        
        li.innerText = `${bn || en || 'N/A'} - ${id || 'N/A'} | ${timestamp} | Generated`;
        historyList.prepend(li);
        
        /* SAVE */
        localStorage.setItem("nidHistory", historyList.innerHTML);
        localStorage.setItem("generateCount", generateCount);
    }
    
    
    /* =========================
       DOWNLOAD BUTTON
    ========================= */
    function downloadCard() {
        
        const cardWrapper = document.getElementById('nid-card-wrapper');
        
        html2canvas(cardWrapper, { useCORS: true, allowTaint: true }).then(canvas => {
            
            const link = document.createElement('a');
            link.download = 'NID.png';
            link.href = canvas.toDataURL();
            link.click();
            
            /* Counter Update */
            downloadCount++;
            document.getElementById('download-count').innerText = downloadCount;
            
            const bn = document.getElementById('o-bn').innerText || 'N/A';
            const id = document.getElementById('o-id').innerText || 'N/A';
            
            const historyList = document.getElementById('history-list');
            const li = document.createElement('li');
            const timestamp = new Date().toLocaleString('bn-BD', { hour12: false });
            
            li.innerText = `${bn} - ${id} | ${timestamp} | Downloaded`;
            historyList.prepend(li);
            
            /* SAVE */
            localStorage.setItem("nidHistory", historyList.innerHTML);
            localStorage.setItem("downloadCount", downloadCount);
            
        });
    }
</script>
</body>
</html>